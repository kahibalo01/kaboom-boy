<html>
	<head>
		<title>Animation class Unit Testing</title>
		<script src = "../js/Defines.js"></script>
		<script src = "../js/engine/GameStateManager.js"></script>
		<script src = "../js/engine/GameEngine.js"></script>
		<script src = "../js/gfx/ImageLoader.js"></script>
		<script src = "../js/gfx/Spritesheet.js"></script>
		<script src = "../js/gfx/Animation.js"></script>
		<script>
			var Game = (function(){
				var GameEngine = KaboomBoy.GameEngine,
					GameStateManager = KaboomBoy.GameStateManager,
					ImageLoader = KaboomBoy.ImageLoader,
					Spritesheet = KaboomBoy.Spritesheet,
					Animation = KaboomBoy.Animation;

				var state = (function(){
					var s = {
						frameCounter: 0,
						fullAnim: null,
						walkingRight1: null,
						walkingRight2: null,
						walkingLeft: null,
						walkingForward: null,
						// counters
						faCounter: 0,
						wr1Paused: true,
						wr2Paused: true,
					};

					s.init = function(){
						// Spritesheet starts on walking right animation
						var spritesheet = new Spritesheet(imageLoader.getImage("character-sprites"), 0, 20, 4, 7, 20, 20);

						var anim = new Animation(spritesheet, {
							numFrames: [7, 7, 2, 2],
							speed: [4, 4, 12, 12]
						});

						this.fullAnim = anim.createHandle();
						this.fullAnim.setSequence(0);

						var walkingAnimation = new Animation(spritesheet, {
							numFrames: [7, 7],
							speed: [4, 4]
						});
						
						this.walkingRight1 = walkingAnimation.createHandle();
						this.walkingRight1.setSequence(0);

						this.walkingRight2 = walkingAnimation.createHandle();
						this.walkingRight2.setSequence(0);

						this.walkingLeft = walkingAnimation.createHandle();
						this.walkingLeft.setSequence(1);

						var walkingForwardAnim = new Animation(spritesheet, {
							rowBase: 2,
							numFrames: [2],
							speed: [12]
						})
						this.walkingForward = walkingForwardAnim.createHandle();
						this.walkingForward.setSequence(0, 0);

						this.walkingRight1.pause();
						this.walkingRight2.pause();
					}

					s.update = function(){
						this.frameCounter++;

						if(this.frameCounter % 240 === 0){
							this.faCounter++;

							if(this.faCounter > 3){
								this.faCounter = 0;
							}

							this.fullAnim.setSequence(this.faCounter);
							console.log("fullAnim change sequence to #" + this.faCounter);
						}



						if(this.frameCounter % 300 === 0){
							this.wr1Paused = !this.wr1Paused;

							if(this.wr1Paused){
								this.walkingRight1.pause();
								console.log("Walking Right 1 animation paused");
							}else{
								this.walkingRight1.unpause();
								console.log("Walking Right 1 animation resumed");
							}

						}

						if(this.frameCounter % 20 === 0){
							this.walkingForward.nextFrame();
						}

						if(this.frameCounter % 420 === 0){
							this.walkingRight2.setSequence(0, 1);
							console.log("Walking Right 2 animation started for 1 times");
						}



						this.fullAnim.update();
						this.walkingRight1.update();
						this.walkingRight2.update();
						this.walkingLeft.update();
						this.walkingForward.update();
					}

					s.render = function(ctx){
						this.fullAnim.render(ctx, 40, 20);
						this.walkingRight1.render(ctx, 80, 20);
						this.walkingRight2.render(ctx, 120, 20);
						this.walkingLeft.render(ctx, 40, 60);
						this.walkingForward.render(ctx, 80, 60);
					}

					return s;
				})();

				var ge, gsm, imageLoader;

				ge = new GameEngine(30, 640, 480, 4);
				gsm = ge.getGameStateManager();
				gsm.addState("state", state);

				imageLoader = new ImageLoader();
				imageLoader.queueLoadImage("character-sprites", "../assets/img/test/Bomber1.png");

				return function(){
					imageLoader.loadAllImages(function(){},
						function(){
							ge.init(document.getElementById("game-container"));
							gsm.loadState("state", true);
							ge.run();
						}
					);
				}
			})();

			window.onload = function(){
				Game();
			}
		</script>
	</head>
	<body>
		<div id = "game-container"></div>
		<div id = "description">

		</div>
	</body>
</html>