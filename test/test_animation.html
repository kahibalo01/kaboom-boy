<html>
	<head>
		<title>Animation class Unit Testing</title>
		<script src = "../js/Defines.js"></script>
		<script src = "../js/engine/GameStateManager.js"></script>
		<script src = "../js/engine/GameEngine.js"></script>
		<script src = "../js/gfx/ImageLoader.js"></script>
		<script src = "../js/gfx/Spritesheet.js"></script>
		<script src = "../js/gfx/Animation.js"></script>
		<script>
			var Game = (function(){
				var GameEngine = KaboomBoy.GameEngine,
					GameStateManager = KaboomBoy.GameStateManager,
					ImageLoader = KaboomBoy.ImageLoader,
					Spritesheet = KaboomBoy.Spritesheet,
					Animation = KaboomBoy.Animation;

				var state = (function(){
					var s = {
						frameCounter: 0,
						completeAnimation: null,
						walkingAnimation1: null,
						walkingAnimation2: null,
						// counters
						caCounter: 0,
						wa1Paused: true,
						wa2Paused: true
					};

					s.init = function(){
						var spritesheet = new Spritesheet(imageLoader.getImage("character-sprites"), 0, 20, 4, 7, 20, 20);

						this.completeAnimation = (new Animation(spritesheet, 0, 0, [7, 7, 2, 2], [4, 4, 12, 12])).createHandle();
						this.completeAnimation.setSequence(0);

						var wa = new Animation(spritesheet, 0, 1, [7], [4]);

						this.walkingAnimation1 = wa.createHandle();
						this.walkingAnimation1.setSequence(0);
						this.walkingAnimation2 = wa.createHandle();
						this.walkingAnimation2.setSequence(0);

						this.walkingAnimation1.pause();
						this.walkingAnimation2.pause();
					}

					s.update = function(){
						this.frameCounter++;

						if(this.frameCounter % 240 === 0){
							this.caCounter++;
							if(this.caCounter > 3){
								this.caCounter = 0;
							}

							console.log("animating completeAnimation sequence #" + this.caCounter);
							this.completeAnimation.setSequence(this.caCounter);
						}


						if(this.frameCounter % 300 === 0){
							this.wa1Paused = !this.wa1Paused;

							if(!this.wa1Paused){
								console.log("walking animation 1 started");
								this.walkingAnimation1.unpause();
							}else{
								console.log("walking animation 1 paused");
								this.walkingAnimation1.pause();
							}
						}

						if(this.frameCounter % 420 === 0){
							this.wa2Paused = !this.wa2Paused;

							if(!this.wa2Paused){
								console.log("walking animation 2 started");
								this.walkingAnimation2.unpause();
							}else{
								console.log("walking animation 2 paused");
								this.walkingAnimation2.pause();
							}
						}

						this.completeAnimation.update();
						this.walkingAnimation1.update();
						this.walkingAnimation2.update();
					}

					s.render = function(ctx){
						this.completeAnimation.render(ctx, 40, 50);
						this.walkingAnimation1.render(ctx, 80, 50);
						this.walkingAnimation2.render(ctx, 120, 50);
					}

					return s;
				})();

				var ge, gsm, imageLoader;

				ge = new GameEngine(30, 640, 480, 4);
				gsm = ge.getGameStateManager();
				gsm.addState("state", state);

				imageLoader = new ImageLoader();
				imageLoader.queueLoadImage("character-sprites", "../assets/img/test/Bomber1.png");

				return function(){
					imageLoader.loadAllImages(function(){},
						function(){
							ge.init(document.getElementById("game-container"));
							gsm.loadState("state", true);
							ge.run();
						}
					);
				}
			})();

			window.onload = function(){
				Game();
			}
		</script>
	</head>
	<body>
		<div id = "game-container"></div>
		<div id = "description">

		</div>
	</body>
</html>