<!-- 
	NOTE: TEST PAGE

	This page is meant to test mainly the `keyhandler` class. but also to a lesser extent the following classes:
		- GameEngine
		- GameStateManager
		- ImageLoader


-->
<!DOCTYPE html>
<html>
	<head>
		<title>KeyHandler Test</title>
		<link rel = "stylesheet" href = "../css/page_style.css"/>
		<script type = "text/javascript" src = "../js/Defines.js"></script>
		<script type = "text/javascript" src = "../js/GameStateManager.js"></script>
		<script type = "text/javascript" src = "../js/GameEngine.js"></script>
		<script type = "text/javascript" src = "../js/ResourceLoader.js"></script>
		<script type = "text/javascript" src = "../js/Spritesheet.js"></script>
		<script type = "text/javascript" src = "../js/InputHandler.js"></script>
		<script>
			var Game = (function(Defines, GameEngine, GameStateManager, ImageLoader, KeyHandler, Spritesheet){
				var engine, gsm, imageloader, keyhandler, state, sprites;
				var directions = [
					{key: "LEFT", keyCode: Defines["LEFT"]},
					{key: "UP", keyCode: Defines["UP"]},
					{key: "RIGHT", keyCode: Defines["RIGHT"]},
					{key: "DOWN", keyCode: Defines["DOWN"]}
				];

				return function(){
					engine = new GameEngine(document.getElementById("game-container"), Defines["FPS"],
						640, 480, Defines["screen_scale"]);
					
					keyhandler = new KeyHandler();
					keyhandler.init(engine.getMainCanvas());
					gsm = engine.getGameStateManager();

					gsm.addState("test", {
						init: function(){
							this.index = 0;
							this.directionText = directions[this.index].key;
							this.sprites = new Spritesheet(imageloader.getImage("directions"), 20, 20);
						},

						update: function(){
							var i, d;
							for(i = 0; i < directions.length; i++){
								d = directions[i];
								if(keyhandler.isDown(d.keyCode)){
									this.index = i;

								}
							}
						},

						render: function(ctx){
							this.sprites.drawSpriteToContext(ctx, this.index, 150, 90);
						}
					});

					imageloader = new ImageLoader();
					imageloader.queueLoadImage("directions", "../assets/img/test/Directions.png");

					
					imageloader.loadAllImages(function(){},
						function(){
							engine.run();
							gsm.loadState("test", true);
						}
					);
				}
				


			})(KaboomBoy.Defines, KaboomBoy.GameEngine, KaboomBoy.GameStateManager, KaboomBoy.ImageLoader, 
			KaboomBoy.KeyHandler, KaboomBoy.Spritesheet);

			window.onload = function(){
				Game();
			}
		</script>
	</head>
	<body>
		<div id = "game-container"></div>
		<div id = "description">
			<h2>KeyHandler Test</h2>
			<b>Instructions: </b>Press the arrow keys to change the image<br>
			<b>Expected Result: </b>Arrow will face the direction you press<br>
		</div>
	</body>
</html>